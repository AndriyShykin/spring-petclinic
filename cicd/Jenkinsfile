pipeline {
  agent none
  environment {
    APP_NAME = 'spring-petclinic'
  }
  stages {
    stage('Build') {
      options {
        timeout(time: 300, unit: 'SECONDS')
      }
      when {
        allOf {
          anyOf {
            changeset "src/main/**"
            triggeredBy 'UserIdCause'
          }
          expression {
            env.BRANCH_NAME in ['main', 'test']
          }
        }
      }
      agent { dockerContainer { image 'shykin/maven:00b2b58a6de794d60956e593e42c832a0ebf5437' } }
      steps {
        sh 'ls -la'
        sh 'mvn'
        sh 'echo $APP_NAME'
      }
    }
  }
}
